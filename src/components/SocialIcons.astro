---
import { SOCIALS } from "../data/socials";
const { size = 24 } = Astro.props;
---

<nav class={`socials`} aria-label="Social links">
  {SOCIALS.map((s) => {
    const isEmail = s.kind === "email";
    return (
      <a class="social"
         href={isEmail ? "/contact/" : s.href}
         target={isEmail ? undefined : "_blank"}
         rel={isEmail ? undefined : "noopener noreferrer"}
         data-user={isEmail ? [...s.user].reverse().join("") : undefined}        /* reversed */
         data-domain={isEmail ? [...s.domain].reverse().join("") : undefined}    /* reversed */
         aria-label={s.label} title={s.label}>
        <i class={s.icon} aria-hidden="true"></i>
        <span class="sr-only">{s.label}</span>
      </a>
    );
  })}
</nav>

<style>
  /* .socials { display: flex; gap: 10px; align-items: center; }                                                                                           */
  /* .social { display: inline-grid; place-items: center; inline-size: {size}px; width: {size}px; height: {size}px; color: var(--ink); border-radius: 6px; */
  /* }                                                                                                                                                     */

  /* .social i { font-size: {Math.round(size * 0.9)}px; line-height: 1; display: block; text-decoration-color: color-mix(in oklab, var(--ink), transparent 70%); */
  /* text-underline-offset: 2px; text-decoration-thickness: 1px;                                                                                                 */
  /* }                                                                                                                                                           */
  /* .social:hover i, .social:focus-visible i { text-decoration-thickness: 2px; text-decoration-color: var(--ink); }                                             */
  .socials { --social-size: ${size}px; display: flex; gap: 10px; align-items: center; }

  /* the clickable box */
  .social {
    display:inline-grid;
    place-items:center;
    inline-size: var(--social-size);
    block-size: var(--social-size);
    min-inline-size: var(--social-size);
    padding: 0;
    border-radius: 6px;
    color: var(--muted);
    transition: color .12s ease, transform .08s ease;
  }

  /* icon sizing: keep it a little smaller than the container */
  .social i {
    font-size: calc(var(--social-size) * 0.62); /* tune: 0.6â€“0.75 works well */
    line-height: 1;
    display:block;
    color: currentColor;
  }

  /* hover / focus */
  .social:hover, .social:focus-visible {
    color: var(--ink);
    transform: translateY(-2px); /* micro-lift; small and quick */
  }
  @media (prefers-reduced-motion: reduce) {
    .social { transition: none; transform: none; }
  }

  /* visually-hidden accessible text */
  .sr-only {
    position: absolute; width: 1px; height: 1px; padding: 0; margin: -1px;
    overflow: hidden; clip: rect(0,0,0,0); white-space: nowrap; border: 0;
  }
</style>

<script is:inline>
  // Assemble "mailto:" only on click; user/domain were reversed in HTML
  document.currentScript?.previousElementSibling?.querySelectorAll('.social[data-user]').forEach((el) => {
    el.addEventListener('click', (e) => {
      // If JS is enabled, build a mailto target and navigate there
      const u = el.getAttribute('data-user')?.split('').reverse().join('');
      const d = el.getAttribute('data-domain')?.split('').reverse().join('');
      if (u && d) {
        e.preventDefault();
        const addr = `${u}@${d}`;
        const mailto = `mailto:${addr}`;
        window.location.href = mailto;
      }
    }, { passive: false });
  });
</script>
