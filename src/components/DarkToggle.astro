<button class="btn btn--ghost" id="theme-toggle" type="button"
        aria-label="Toggle dark mode" aria-pressed="false">
  <i class="fa-solid fa-sun icon-only"  data-icon="sun"  aria-hidden="true"></i>
  <i class="fa-solid fa-moon icon-only" data-icon="moon" aria-hidden="true"></i>
</button>

<style>
  /* Center perfectly and inherit colors */
  .icon-only{
    inline-size: 36px;
    block-size: 36px;
    padding: 0;
    border-radius: 6px;
    display: inline-grid;
    place-items: center;
    color: var(--muted);
  }
  .icon-only:hover { color: var(--ink); }
  .icon-only i{ line-height: 0; font-size: 18px; color: currentColor; }

  /* Hide both by default, then reveal one based on <html data-theme> */
  .icon-only [data-icon]{ display: none; }

  /* IMPORTANT: use :global so Astro doesnâ€™t scope these selectors */
  :global(html[data-theme="dark"]) .icon-only [data-icon="moon"] { display: inline-block; }
  :global(html:not([data-theme="dark"])) .icon-only [data-icon="sun"] { display: inline-block; }
</style>

<script is:inline>
  (() => {
    const root = document.documentElement;
    const btn  = document.getElementById('theme-toggle');
    const meta = document.getElementById('meta-theme-color');

    const sync = () => {
      const dark = root.dataset.theme === 'dark';
      btn.setAttribute('aria-pressed', dark ? 'true' : 'false');
      btn.setAttribute('aria-label', dark ? 'Switch to light theme' : 'Switch to dark theme');
    };

    const setTheme = (next) => {
      root.dataset.theme = next;
      try { localStorage.setItem('theme', next); } catch {}
      // Smooth fade (removed automatically)
      root.classList.add('theme-anim');
      clearTimeout(window.__themeAnimTimer);
      window.__themeAnimTimer = setTimeout(() => root.classList.remove('theme-anim'), 260);
      // Update browser UI color (if you included it in <head>)
      if (meta) meta.setAttribute('content', next === 'dark' ? '#0F1115' : '#F7F6F3');
      // Notify listeners (Giscus, etc.)
      window.dispatchEvent(new CustomEvent('theme-change', { detail: next }));
      sync();
    };

    btn?.addEventListener('click', () => {
      const next = root.dataset.theme === 'dark' ? 'light' : 'dark';
      setTheme(next);
    });

    // Keep icons/aria synced if something else flips theme
    window.addEventListener?.('astro:after-swap', sync);
    window.matchMedia?.('(prefers-color-scheme: dark)')
      .addEventListener?.('change', () => sync());

    sync();
  })();
</script>
