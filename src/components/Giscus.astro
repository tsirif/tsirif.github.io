---
const repo       = import.meta.env.PUBLIC_GISCUS_REPO;        // e.g., "tsirif/tsirif.github.io"
const repoId     = import.meta.env.PUBLIC_GISCUS_REPO_ID;     // from giscus.app
const category   = import.meta.env.PUBLIC_GISCUS_CATEGORY;    // visible name, e.g. "General"
const categoryId = import.meta.env.PUBLIC_GISCUS_CATEGORY_ID; // from giscus.app

// Theme pairing that matches your palette well:
const lightTheme = 'light_protanopia';             // GitHub Light
const darkTheme  = 'dark_protanopia';  // lets your dark background show through
---

{(repo && repoId && category && categoryId) ? (
<div id="giscus_thread"></div>
<script>
  (function(){
    const mode  = document.documentElement.dataset.theme === 'dark' ? 'dark' : 'light';
    const theme = mode === 'dark' ? darkTheme : lightTheme;

    const s = document.createElement('script');
    s.src = 'https://giscus.app/client.js';
    s.async = true;
    s.crossOrigin = 'anonymous';
    s.setAttribute('data-repo', 'tsirif/tsirif.github.io');
    s.setAttribute('data-repo-id', '…');
    s.setAttribute('data-category', 'General');
    s.setAttribute('data-category-id', '…');
    s.setAttribute('data-mapping', 'pathname');
    s.setAttribute('data-reactions-enabled', '1');
    s.setAttribute('data-emit-metadata', '0');
    s.setAttribute('data-lang', 'en');
    s.setAttribute('data-theme', theme);   // initial theme via data-theme
    document.getElementById('giscus_thread').appendChild(s);

    // then keep syncing on toggle using setConfig.theme
    window.addEventListener('theme-change', (e) => {
      const t = e.detail === 'dark' ? darkTheme : lightTheme;
      document.querySelector('iframe.giscus-frame')?.contentWindow?.postMessage(
        { giscus: { setConfig: { theme: t } } },
        'https://giscus.app'
      );
    });
  })();
</script>
) : (
  <p class="muted">Comments are not configured yet.</p>
)}
