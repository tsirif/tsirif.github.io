---
import BaseLayout from "../../layouts/BaseLayout.astro";
import { getCollection } from "astro:content";
import EntryCard from "../../components/EntryCard.astro";
import ProjectsFilter from "../../components/ProjectsFilter.jsx";

const projects = (await getCollection("projects"))
  .sort((a,b) => (b.data.date as Date).getTime() - (a.data.date as Date).getTime());

const items = projects.map(p => ({
  id: p.slug,
  title: p.data.title,
  tldr: p.data.tldr || "",
  abstract: p.data.abstract || "",
  keywords: (p.data.keywords || []).map(t => String(t).toLowerCase()),
  date: p.data.date,
  impact: { citations: p.data.impact?.citations || 0, github_stars: p.data.impact?.github_stars || 0 }
}));
---

<BaseLayout title="Projects & Publications" wide={true} description="Projects, publications, demos, explainers.">
  <h1>Projects & Publications</h1>
  <p class="muted">Use filters to narrow down; sorting and relevance will reorder the list.</p>

  <ProjectsFilter
    client:load
    items={items}
    listSelector="#projects-list"
    counterSelector="#projects-count"
    emptySelector="#projects-empty"
  />

  <p id="projects-empty" class="muted" hidden style="margin: 12px 0;">No results match.</p>

  <div class="projects-grid" id="projects-list" data-list="projects" style="margin-top:16px;">
    {projects.map((p) => <EntryCard entry={p} kind="project" />)}
  </div>

</BaseLayout>
