---
import BaseLayout from "../../layouts/BaseLayout.astro";
import { getCollection } from "astro:content";
import EntryCard from "../../components/EntryCard.astro";
import WritingFilter from "../../components/WritingFilter.jsx";

const posts = (await getCollection("writing"))
  .sort((a,b) => (b.data.date as Date).getTime() - (a.data.date as Date).getTime());

const items = posts.map(p => ({
  id: p.slug,
  title: p.data.title,
  summary: p.data.summary || "",
  keywords: (p.data.keywords || []).map(t => String(t).toLowerCase()),
  date: p.data.date
}));
---

<BaseLayout title="Writing" wide={true} description="Essays, opinions, explainers.">
  <h1>Writing</h1>
  <p class="muted">
    <a class="link" href="/writing/rss.xml">RSS feed</a>
</p>
  <p class="muted">Use filters to narrow down; sorting and relevance will reorder the list.</p>

  <WritingFilter client:load items={items} />

  <p id="writing-empty" class="muted" hidden style="margin: 12px 0;">No results match.</p>

  <div class="projects-grid" data-list="writing" style="margin-top: 16px;">
    {posts.map((p) => <EntryCard entry={p} kind="writing" />)}
  </div>
</BaseLayout>
